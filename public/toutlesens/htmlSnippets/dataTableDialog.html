<script>

    var dataTableDialog = (function () {
        var self = {};
        self.dataset;
        self.init = function (data) {
            self.dataset = data;
            var properties = []
            data.forEach(function (line) {
                for (var key in line) {
                    if (properties.indexOf(key) < 0)
                        properties.push(key);
                }
            })
            var html = "";
            properties.forEach(function (prop) {
                var checked = "";
                if (prop == "connectedTo" || prop == Schema.schema.defaultNodeNameProperty)
                    checked = "checked='checked'"

                html += "<br><input type=checkbox class='dataTableDialog_propcbx' value='" + prop + "'" + checked + "> " + prop;
            })
            $("#dataTableDialog_cbxsDiv").html(html);

        }


        self.execute = function () {

            var checkedProperties = [];
            $(".dataTableDialog_propcbx").each(function (index, cbx) {
                if ($(this).prop("checked")) {
                    checkedProperties.push(cbx.value)
                }
            })

            self.dataset.forEach(function (line, index) {
                for (var key in line) {

                    if (key == "connectedTo") {
                        if (line[key].length > 200)
                            self.dataset[index][key] = line[key].substring(0, 200) + "...";
                    }

                    if (checkedProperties.indexOf(key) < 0)
                        delete  self.dataset[index][key];

                }
            })
            if (!toutlesensController.graphDataTable) {
                toutlesensController.graphDataTable = new myDataTable();
                toutlesensController.graphDataTable.pageLength = 30;
            }

            //if($('#dialog').dialog)
            $('.ui-button-icon').click();
            //  $('#dialog').dialog("close");
            // $('#dialogLarge').html("<div id='dataTableDiv' style='width: 600px'></div>").promise().done(function () {
            //   $('#dialogLarge').load("htmlSnippets/dataTable.html", function () {
            //   $('#dialogLarge').dialog("open");


            dialogLarge.load("htmlSnippets/dataTable.html", function () {
                dialogLarge.dialog("open");

                toutlesensController.graphDataTable.loadJsonInTable(null, "dataTableDiv", self.dataset, function (err, result) {


                }, 2000)

            })
        }

        self.initStatsDialog = function () {
            $("#dataTableDialog_statsDiv").css("visibility", "visible");
            debugger;
            var labels = []
            dataTableDialog.dataset.forEach(function (line) {
                if (labels.indexOf(line.label) < 0) {
                    labels.push(line.label)
                }
            })
            common.fillSelectOptionsWithStringArray(stats_sourceLabelSelect, labels, true)
            common.fillSelectOptionsWithStringArray(stats_targetLabelSelect, labels, true)


        }


        return self;

    })()

   


</script>


<div id="dataTableDialog_cbxsDiv">


</div>
<button onclick="dataTableDialog.execute()">Show</button>
<button onclick="dataTableDialog.initStatsDialog()">Stats</button>

<div id="dataTableDialog_statsDiv" style="visibility: hidden">

    <select id="stats_typeSelect">
        <option value="relationsRanking"> relationsRanking</option>

    </select>

    source label <select id="stats_sourceLabelSelect">


</select>
    target label <select id="stats_targetLabelSelect">


</select>
    <button onclick="stats.execute()">ok</button>

</div>
