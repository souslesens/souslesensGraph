<!-- *******************************************************************************
 * SOUSLESENS LICENSE************************
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2016-2017 Claude Fauconnet claude.fauconnet@neuf.fr
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 ******************************************************************************-->

<!DOCTYPE html>
<html>
<head>
    <meta charset="ISO-8859-1">
    <title>souslesens</title>


    <!--  <link rel="stylesheet" type="text/css" title="Design"
            href="../common/js/jquery/theme_humanity/jquery-ui.min.css"/>-->
    <link rel="stylesheet" media="screen" type="text/css" title="Design" href="../common/js/jquery/jquery-ui.min.css"/>


    <link rel="stylesheet" href="../common/js/jsTree/themes/default/style.min.css"/>

    <!--<link rel="stylesheet" href="js/Tree/themes/default/style.min.css"/>-->
    <!--<link rel="stylesheet" type="text/css"
        href="../common/js/others/jquery.handsontable.full.min.css" />-->

    <link rel="stylesheet" type="text/css" href="css/d3tree.css"/>
    <link rel="stylesheet" type="text/css" href="css/index.css"/>
    <link rel="stylesheet" type="text/css" href="css/treemap.css"/>

    <link rel="stylesheet" type="text/css" href="css/cards.css"/>

    <script src="../common/js/jquery/jquery.min.js"></script>
    <script src="../common/js/jquery/jquery-ui.min.js"></script>
    <!--

      <link rel="stylesheet" type="text/css"
              href="https://cdn.datatables.net/v/dt/dt-1.10.18/b-1.5.4/b-colvis-1.5.4/b-html5-1.5.4/b-print-1.5.4/fc-3.2.5/fh-3.1.4/r-2.2.2/sc-1.5.0/sl-1.2.6/datatables.min.css"/>

        <script type="text/javascript"
                src="https://cdn.datatables.net/v/dt/dt-1.10.18/b-1.5.4/b-colvis-1.5.4/b-html5-1.5.4/b-print-1.5.4/fc-3.2.5/fh-3.1.4/r-2.2.2/sc-1.5.0/sl-1.2.6/datatables.min.js"></script>
    -->

    <script src="js/dataTable.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.18/b-1.5.4/b-html5-1.5.4/b-print-1.5.4/datatables.min.css"/>

    <script type="text/javascript"
            src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.18/b-1.5.4/b-html5-1.5.4/b-print-1.5.4/datatables.min.js"></script>


    <script src="resources/params.js"></script>
    <script src="../common/js/neo4jDataModel.js"></script>

    <script src="../common/js/d3/d3.js"></script>
    <script src="../../common/js/d3/d3-colorLegend.js"></script>
    <!--<script src="https://d3js.org/d3.v4.min.js"></script>-->
    <!--<script src="https://d3js.org/d3.v4.min.js"></script>-->

    <script src="js/globalVars.js"></script>


    <script src="../common/js/common.js"></script>

    <script src="js/customizeUI.js"></script>
    <script src="js/toutlesensController.js"></script>
    <script src="js/toutlesensData.js"></script>
    <script src="js/toutlesensDialogsController.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/paint.js"></script>
    <script src="js/traversalController.js"></script>
    <script src="js/algorithms.js"></script>
    <script src="js/complexQueries.js"></script>


    <script src="js/paramsController.js"></script>


    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
    <script src="js/tagCloud/cloudD3js.js"></script>
    <script src="js/tagCloud/tagCloud.js"></script>
    <!--   <script src="js/modifyData.js"></script>
     <script src="js/mainMenu.js"></script>

     <script src="js//externalRessourcesCommon.js"></script>
     <script src="js//externalRessourcesDbPedia.js"></script>
     <script src="js//externalRessourcesBNF.js"></script>


     <script src="js/d3common.js"></script>
     <script src="js/d3legend.js"></script>

     <script src="js/d3flower.js"></script>

     <script src="js/d3simpleForce.js"></script>
     <script src="js/d3simpleForceLight.js"></script>
     <script src="js/souslesensForcelayout.js"></script>
     <script src="js/d3simpleForceBulk.js"></script>
     <script src="js/d3treemap.js"></script>
     <script src="js/d3forceCollapseClass.js"></script>
     <script src="js/d3tree.js"></script>
     <script src="js/d3schema.js"></script>  -->

    <script src="js/cards.js"></script>

    <script src="../common/js/common.js"></script>
    <script src="../common/js/util.js"></script>
    <script src="js/d3.treemap2.js"></script>

    <!--<script src="js//d3.forceGraphClass.js"></script>
    <script src="js//d3.dndTreeClass.js"></script>
    <script src="js//d3.modifiableGraph.js"></script>
    <script src="js//d3.forceCollapseClass.js"></script>
    <script src="js//d3.gantt.js"></script>
    <script src="js//gant-chart-d3v2.js"></script>
    <script type="text/javascript" src="js//gant-chart-d3v2.js"></script>
    <script type="text/javascript" src="js//d3.gantt.js"></script>

    <script src="../admin/js//graphD3.js"></script>
     <script src="js/advancedDisplay.js"></script>
    -->
    <script src="js/textOutputs.js"></script>


    <script src="js/selection.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/traversalQueries.js"></script>


    <script src="../common/js/jsTree/jstree.min.js"></script>
    <!--<script src="./js/jsTree/treeController.js"></script>-->
    <script src="./js/treeController.js"></script>

    <script src="./js/neoToMongo.js"></script>


    <script src="js/advancedSearch.js"></script>
    <script src="../common/js/others/tableFlip.js"></script>


    <script src="js/help.js"></script>
    <script src="js/lang.js"></script>
    <script src="resources/lang_FR.js"></script>
    <script src="resources/lang_EN.js"></script>
    <script src="js/functionalities.js"></script>
    <script src="js/versionController.js"></script>
    <script src="js/eventsController.js"></script>
    <script src="js/savedQueries.js"></script>
    <script src="js/searchMenu.js"></script>

    <script src="../common/js/cypher.js"></script>
    <!-- <script src="js/d3graphCreation.js"></script>-->
    <script src="../common/js/others/async.js"></script>


    <script src="js/visjs/visjs.js"></script>
    <script src="js/visjs/visJsGraph.js"></script>
    <script src="../common/js/connectors.js"></script>
    <script src="js/visjs/visJsDragRect.js"></script>
    <link rel="stylesheet" type="text/css" href="js/visjs/vis-network.min.css.js"/>


    <script src="js/writeDataController.js"></script>

    <script src="./js/schema.js"></script>
    <script src="./js/context.js"></script>


    <style>
        a {
            font-weight: bold;
            font-style: italic;
            color: #261803;
            font-size: 12px;
        }

        a:link {
            text-decoration: none;
        }

        a:visited {
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        a:active {
            text-decoration: underline;
        }

        #treeContainer {
            width: 500px;
            overflow: auto;
            background-color: #f6f6f6;

        }

        #nodeInfosDiv {
        / / display: flex;
            justify-content: center;
            align-items: center;
            border-width: 1px;
            border-color: #5f3f3f;
            border-style: groove;
        }

        #word, #nodesLabelsSelect {
            width: 130px;
        }

        #nodeInfosDiv, relationInfosDivWrapper {
            padding: 20px;
            border-width: 0px;
            border-color: #5f3f3f;
            border-style: groove;
            margin: 20px;

            overflow: auto;
            height: 500px;
            background-color: seashell;
            font-size: 14px;
            font-family: verdana, sans-serif;
            font-weight: normal;

        }

        #infosHeaderDiv {
            background-color: burlywood;
            font-size: 14px;
            font-weight: bold;
        }

        .objAttrInput, #newNodeName {

            width: 200px;

        }

        .displayIcon-selected {
            border-width: 5px;
            border-color: #666;
            border-color: #af9d09;

            border-style: inset;
        }

        .infoTitle {
            font-size: 14px;
            font-family: verdana, sans-serif;
            font-weight: bold;
        }

        #innerLegendDiv, #relInfoDiv {
            margin-left: 20px;
            font-size: 10px;
            font-family: verdana, sans-serif;
            font-weight: bold;
        }

        #dialog {
            background-color: #cdd0d6;
        }

        #graphCommentDiv {
            font-size: 12px;
            font-family: verdana, sans-serif;
            font-weight: normal;
        }

        .importantMessage {
            color: #f8893f;
        }

        #graphPopup {
            border: #261803;
            border-width: 1px;
            border-radius: 5px;
            border-style: solid;
            background-color: #cdd0d6
        }

        .jstreeWordProp {
            color: red;
        }

        .BIlegendSpan {
        / / border-style: solid;
        / / border-width: 2 px;

        }

        .myDatatable tr {
            height: 20px !important;
        }

        .findTab {
            min-height: 200px;

        }


    </style>

    <script>

        $(function () {

            // jQuery is loaded => print the version
            console.log("jquery version : " + jQuery.fn.jquery);
            //  console.log("jquery UI version : "+$.ui.version);


            queryParams = common.getQueryParams(document.location.search);
            customizeUI.init();
            subGraph = queryParams.subGraph;
            if (!subGraph)
                subGraph = Gparams.defaultSubGraph;
            functionalities.hideFunctionalities();
            lang.setLangage();
            $("#analyzePanel").load("htmlSnippets/analyze.html", function () {

            })
            eventsController.initInputEvents();
            eventsController.initcomponentEvents()
            savedQueries.loadQueryRuns();

            var mode = queryParams.mode;
            if (mode == "write")
                Gparams.readOnly = false;


            totalWidth = $(window).width() - 20;
            totalHeight = $(window).height() - 20;

            $("body").height(totalHeight);


            rightPanelWidth = Gparams.rightPanelWidth;
            filterDiv = "radarFiltersDiv";
            bcsTreeDiv = "#bcsTreeDiv";
            radarDiv = "#radarDiv";
            attrsIFrame = "#attrsIframe";


            var afterLoadModelTasks = [
                eventsController.initInputEvents,
                eventsController.initcomponentEvents,
                treeController.initLabels,
                toutlesensController.intiRelationTypes,
                customizeUI.customize,
                toutlesensController.afterGraphInit,
                statistics.initLabelsCurrentQueries,
                functionalities.initFunctionalities

                //  advancedSearch.patternInitLabels,
                // advancedSearch.patternInitRelTypes,
                // advancedDisplay.initDecorationDiv,


            ]

            Schema.load(subGraph, function (err, schema) {
                if (err)
                    return setMessage("Error cannot load Schema");
                // play init UI methods after schema is loaded
                for (var i = 0; i < afterLoadModelTasks.length; i++) {
                 //   try {
                        afterLoadModelTasks[i](subGraph);
                /*    }
                    catch (err) {
                        console.log("" + i + "  " + err);
                    }*/
                }

                toutlesensController.appInitEnded = true;

            })

            versionController.initVersions();
            var version = null;
            if (queryParams.displayVersion) {
                version = queryParams.displayVersion;
                Gparams.displayVersion = queryParams.displayVersion
            }
            versionController.applyVersion(version);


        })


    </script>
</head>
<body>


<!--  ****************************************************main panel***************************-->


<div id="mainPanel">


    <div id="graphDiv"></div>

</div>


<div id="mainButtons">
    <img id="waitImg" src="images/waitAnimated.gif" width="20px" style="visibility: hidden;">
    <input type="image" title="<span id='lang_XX'>schema</span>" height="20px"

           id="schemaButton" src="images/cube.png"/>

    <input type="image" title="display settings" height="20px"
           onclick="toutlesensController.dispatchAction('displaySettings')"
           id="displaySettingButton" src="images/display.png"/></td>
    &nbsp;<input type="image" title="Display all nodes" height="20px"
                 onclick="toutlesensController.dispatchAction('showAll')"
                 id="searchAllButton" src="images/all.png"/></td>
    <input type="image" title="Graph menu" height="20px"
           onclick="toutlesensController.dispatchAction('showGlobalMenu');" id="parametersMenuButton"
           src="images/parameters.png"/>
    <input type="image" title="Export to text" height="20px"
           onclick="toutlesensController.dispatchAction('showGraphTable')" id="toTextMenuButton" src="images/text.png"
           class="graphDisplayed"/>
    <input type="image" title="Zoom on node" height="20px" onclick="toutlesensController.dispatchAction('zoomOnNode')"
           id="zoomOnNodeMenuButton"
           src="images/zoom.png" class="graphDisplayed"/>
    <input type="image" title="Fit to page" height="20px" onclick="visjsGraph.fitToPage()" id="fitMenuButton"
           src="images/fit.png" class="graphDisplayed"/>
    <input type="image" title="Take a snapshot" height="20px"
           onclick="toutlesensController.dispatchAction('graphorama')" id="snapShotMenuButton"
           src="images/snapshot.png" class="aa"/>

    <input type="image" title="Previous graph" height="20px" onclick="visjsGraph.showPreviousGraph()"
           id="previousGraphMenuButton" src="images/previous.jpg"/>
    <input type="image" title="Next graph" height="20px" onclick="visjsGraph.showNextGraph()" id="nextGraphMenuButton"
           src="images/next.jpg"/>
    <input type="image" title="Next display" height="20px" onclick="toutlesensController.dispatchAction('addNode')"
           class="canModify" ; id="newNodeButton" src="images/newNode.png"/>

    <br><span id="graphInfosSpan" style="font-size:8px"></span>

</div>
<div id="graphLegendDiv"></div>
<div id="graphInfosDiv" style="font-size: 8px"></div>
<div id="graphCommentDiv" style="position: absolute;background-color: white;margin: 2px;padding: 2px"></div>
<div id="BIlegendDiv"
     style="visibility:hidden;z-index:20;border: 1px;border-style: solid;padding: 5px;background-color: #fafafa;max-height: 400px;max-width: 250px;overflow: auto"></div>


<div id="mainAccordion">
    <h3><b>Query</b></h3>
    <div id="findDiv" class="mainAccordionPanel">

        <div id="findTabs">
            <ul id="findTabsUl">
                <li><a href="#queryDiv"><span>Query </span></a></li>
                <li><a href="#nodeDiv"><span>Node  </span></a></li>
                <li><a href="#relationDiv"><span>Relation </span></a></li>

                <li><a href="#pathDiv"><span>Pathes </span></a></li>
                <li><a href="#advancedQueriesDiv" id="advancedQueriesTabLi"><span>Advanced </span></a></li>

                <li><a href="#pluginDiv" id="pluginLi"><span>Plugin </span></a></li>
                <!--     <li><a href="#tagCloudDiv" id="tagCloudLi"><span >tagCloud</span></a></li>-->


                <!--  <li><a href="#requestDiv"><span >Request </span></a></li>-->


            </ul>
            <script>
                // customizeUI.addPlugins(Gparams.plugins);  PB initalisation dialog and tabs
            </script>


            <div id="nodeDiv" class="findTab">
                <div id="nodeDivDetachable">
                    <input type="hidden" value="500" id="limitResult">
                    <table border="0">
                        <tr>
                            <td>
                                <table>
                                    <tr align="center">
                                        <td><span id='lang_1'>Node</span></td>
                                        <td><input id="word"

                                                   size="10"></td>
                                        <td><input type="image" id="eraseWordButton" height="20px"
                                                   src="images/erase.png"></td>




                                    </tr>

                                </table>


                            </td>

                        </tr>
                        </tr>
                        <td colspan="2">
                            <div id="searchResultMessage"
                                 style="color: #0000cc;font-size: 10px;font-style: italic"></div>
                        </td>

                        <tr>

                        <tr>
                            <td colspan="2">


                                <div id="treeContainer">
                                    <div id="genericTree"></div>
                                </div>

                            </td>


                        </tr>


                    </table>
                </div>

            </div>


            <div id="relationDiv" class="findTab">
                type <select id="findRelationsTypeSelect"
                             onchange="toutlesensController.setRelationProperties(this)"></select>
                <br>
                property <select id="findRelationsPropertyKeySelect"></select>
                <select id="findRelationsPropertyOperatorSelect">
                    <option>=</option>
                    <option><></option>
                    <option>&lt;</option>
                    <option>&gt;</option>

                </select>
                <input id="findRelationsPropertyValueInput" size="10">
                <button onclick="toutlesensController.generateGraphFromRelType()"> OK</button>

                </input>
                <div id="findRelationsCurrentType"></div>

            </div>

            <div id="pathDiv" class="findTab">

                <table>
                    <tr>
                        <td colspan="3">


                            <select id="pathType">
                                <option value="shortestPath">
                                    Shortest path
                                </option>
                                <!-- <option value="allTransitivePaths">
                                     All paths
                                 </option>-->

                            </select>
                        </td>
                    </tr>
                    <tr>

                        <td>
                            <button onclick="traversalController.showSearchMenu('source'); ">Between node</button>
                            <br><span id="pathes_sourceNode"></span></td>
                        <td></td>

                    </tr>
                    <tr>


                        <td>
                            <button onclick="traversalController.showSearchMenu('target'); ">And node</button>
                            <br><span id="pathes_targetNode" class="targetNode"></span></td>
                        <td></td>

                    </tr>


                    <tr>
                        <td colspan="3">

                            <div id="pathes_buttonsDiv"></div>
                            <!--  <button onclick="traversalController.executePathesUI()"
                                      id="executeShortestPathButton" style="visibility:hidden">Search
                              </button>
                              <button onclick="traversalController.executeMoreOrLessShortestPathTraversalSearch(true)"
                                      id="executeLessShortestPathButton" style="visibility:hidden">-
                              </button>
                              <button onclick="traversalController.executeMoreOrLessShortestPathTraversalSearch()"
                                      id="executeMoreShortestPathButton" style="visibility:hidden">+
                              </button>-->


                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            &nbsp;<span id="shortestPathDistance"></span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <div id="traversalFindDiv" style="background-color: #b3b6c2">
                            </div>
                        </td>
                    </tr>


                </table>

            </div>

            <div id="advancedQueriesDiv" class="findTab">
                <div id="advancedQueriesAccordion">
                    <h3>Pivots nodes</h3>
                    <div>
                        <div id="pivotsDiv" style="height:450px"></div>
                    </div>
                    <!--   <h3>Count by label</h3>
                       <div>
                           <div id="countByLabelDiv" style="height:450px"></div>
                       </div>
                       <h3>transitive relations</h3>
                       <div id="transitiveRelationsDiv" style="height:450px"></div>-->
                    <h3>Cypher query</h3>

                    <div id="cypherQueryDiv" style="height:450px"></div>


                </div>
            </div>
            <!--  <div id="tagCloudDiv">
              <iframe id='tagCloudIframe' src='htmlSnippets/tagCloud.html' style='width: 100%;height: 500px'>
              </iframe>
              </div>-->

            <div id="queryDiv" class="findTab">
            </div>

            <div id="pluginDiv" class="findTab"></div>

            <!--    <div id="requestDiv">

                </div>-->
        </div>

    </div>

    <h3><b>Analyze</b></h3>
    <div id="analyzePanel" class="mainAccordionPanel">


    </div>
    <h3><b>Graphoramas</b></h3>
    <div id="graphoramasDiv" class="mainAccordionPanel"></div>

</div>


<div id="graphPopup"
     style="visibility: hidden;position: absolute;background-color: white;margin: 2px;padding: 2px"></div>

<div id="dialog" title="dialog"></div>
<div id="dialogLarge"></div>
<div id="controlPanelShowHide">

    <input type="image" title="Graph menu" height="20px"
           onclick="toutlesensController.switchanalyzePanelDisplay();" id="fullScreenButton"
           src="images/fullScreen.png"/>
</div>


</body>
</html>